<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Page Article</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <link rel="stylesheet" href="article.css">
  <style>
    .menu-btn:hover {
      background-color: #45a049;
      border: blanchedalmond solid 2px;
    }

    .menu {
      display: none;
      position: absolute;
      background-color: #f1f1f1;
      top: 10%;
      left: 0%;
      min-width: 160px;
      z-index: 1;
      border-radius: 5px;
      box-shadow: 0px 8px 16px rgba(0, 0, 0, 0.2);
    }

    .menu a {
      color: black;
      padding: 12px 16px;
      text-decoration: none;
      display: block;
    }

    .menu a:hover {
      background-color: #ddd;
      border: #1e88e5 solid 1px;
    }

    .menu-btn:focus + .menu {
      display: block;
    }

    body {
    background-color: #121212;
    color: #f1f1f1;
    font-family: 'Segoe UI', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;  /* Centre verticalement */
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
 }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
    }

    p {
      font-size: 1.2rem;
      margin-bottom: 30px;
      text-align: center;
      max-width: 600px;
    }

    .article {
      background-color: #1e1e1e;
      border: 1px solid #333;
      padding: 15px;
      margin: 10px;
      border-radius: 8px;
      width: 100%;
      box-sizing: border-box;
    }

    .article button {
      background-color: #e53935;
      color: white;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      border-radius: 4px;
    }

    .article button:hover {
      background-color: #d32f2f;
    }
  </style>
</head>

<body>
  <div class="page-container">
     <main>
      <!-- Logo et titre -->
      <img src="image/logo.png" alt="Logo de l'application" class="app-logo">
      <h1>üì± IP Checker</h1>

      <!-- Menu -->
      <button class="menu-btn" tabindex="0">Menu</button>
      <div class="menu">
        <a href="article.html">Article</a>
        <a href="index.html">Accueil</a>
        <a href="contact.html">Contact</a>
        <a href="aide.html">Page Aide</a>
        <a href="propos.html">√Ä propos</a>
      </div>

      <h1>üîê Zone Admin</h1>

      <!-- Zone de connexion -->
      <div id="auth">
        <p>Entrez le mot de passe pour acc√©der √† l'espace admin :</p>
        <input type="password" id="pwd" placeholder="Mot de passe"><br>
        <button class="btn-valider" onclick="checkPassword()">Valider</button>
        <p style="font-style: italic; color: gray;">Vous pouvez consulter les articles ci-dessous sans √™tre connect√©.</p>

        <h2>üìÑ Articles publi√©s</h2>
        <div class="articles.json"></div>
      </div>

      <!-- Zone admin -->
      <div id="admin" style="display: none;">
        <h2>üìù Publier un nouvel article</h2>
        <form id="articleForm">
          <input type="text" id="titre" placeholder="Titre de l‚Äôarticle" required><br>
          <textarea id="contenu" placeholder="Contenu..." rows="8" required></textarea><br>
          <button class="btn-publier" type="submit">Publier</button>
          <button type="button" class="btn-deconnexion" onclick="logout()">üö™ Se d√©connecter</button>
        </form>

        <h2>üìÑ Articles publi√©s</h2>
        <div class="articles.json"></div>

      </div>
  </main>

  <!-- Script principal -->
  <script>
    
    const hashAttendu = "798a02cda8af9482b4051326371d7ef163b4cdba8fc754e4e290df1eb6038a21";

    async function sha256(text) {
      const buffer = new TextEncoder().encode(text);
      const hashBuffer = await crypto.subtle.digest("SHA-256", buffer);
      return [...new Uint8Array(hashBuffer)].map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function checkPassword() {
      const input = document.getElementById("pwd").value;
      const hash = await sha256(input);
      if (hash === hashAttendu) {
        localStorage.setItem("admin", "true");
        location.reload(); // recharge pour afficher la vue admin
      } else {
        alert("Mot de passe incorrect.");
      }
    }

    function afficherArticles() {
      const articlesDivs = document.querySelectorAll('.articles');
      const articles = JSON.parse(localStorage.getItem("articles") || "[]");
      articlesDivs.forEach(div => div.innerHTML = '');
      articles.forEach((art, index) => {
        const div = document.createElement('div');
        div.className = 'article';
        div.innerHTML = `
          <h3>${art.titre}</h3>
          <p>${art.contenu.replace(/\n/g, '<br>')}</p>
            
             ${
            localStorage.getItem("admin") === "true"
              ? `
          <button onclick="modifierArticle(${index})">‚úèÔ∏è Modifier</button>
          <button onclick="supprimerArticle(${index})">üóëÔ∏è Supprimer</button>
          `
              : ""
          }
        `;
        articlesDivs.forEach((adiv) => adiv.appendChild(div.cloneNode(true)));
      });
    }

    function supprimerArticle(index) {
      let articles = JSON.parse(localStorage.getItem("articles") || "[]");
      articles.splice(index, 1);
      localStorage.setItem("articles", JSON.stringify(articles));
      afficherArticles();
    }

    function modifierArticle(index) {
      const articles = JSON.parse(localStorage.getItem("articles") || "[]");
      const article = articles[index];

      const newTitre = prompt("Modifier le titre :", article.titre);
      const newContenu = prompt("Modifier le contenu :", article.contenu);

      if (newTitre !== null && newContenu !== null) {
        articles[index] = { titre: newTitre.trim(), contenu: newContenu.trim() };
        localStorage.setItem("articles", JSON.stringify(articles));
        afficherArticles();
      }
    }

         

    function logout() {
      localStorage.removeItem("admin");
      location.reload();
    }

    document.addEventListener('DOMContentLoaded', () => {
  const estAdmin = localStorage.getItem("admin") === "true";
  document.getElementById("auth").style.display = estAdmin ? "none" : "block";
  document.getElementById("admin").style.display = estAdmin ? "block" : "none";
  afficherArticles();

  // ‚úÖ G√®re la publication d'un article
  const form = document.getElementById("articleForm");
  if (form) {
    form.addEventListener("submit", function(e) {
      e.preventDefault(); // Emp√™che le rechargement
      const titre = document.getElementById("titre").value.trim();
      const contenu = document.getElementById("contenu").value.trim();

      if (titre && contenu) {
        const articles = JSON.parse(localStorage.getItem("articles") || "[]");
        articles.unshift({ titre, contenu }); // ajoute au d√©but
        localStorage.setItem("articles", JSON.stringify(articles));
        afficherArticles();
        this.reset(); // vide le formulaire
      } else {
        alert("Veuillez remplir tous les champs.");
      }
    });
  }
});
      // Chargement du fichier articles.json
     fetch('https://ip-checker-913b6.web.app/articles.json')
  .then(res => res.json())
  .then(articles => {
    const container = document.getElementById('articles-json');
    articles.forEach(article => {
      const div = document.createElement('div');
      div.className = 'article';
      div.innerHTML = `<h3>${article.titre}</h3><p>${article.contenu}</p>`;
      container.appendChild(div);
    });
  })
  .catch(err => console.error("Erreur de chargement des articles :", err));
</script>
<!-- Script principal -->
<script src="article.js"></script>
</body>
</html>
